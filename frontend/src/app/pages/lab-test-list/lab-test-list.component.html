<div class="container mt-4">
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lab Test List</h2>
    <button class="btn btn-success" (click)="openCreateModal()">Create New Lab Test</button>
</div>

  <table class="table table-striped">
    <thead>      <tr>
        <th>ID</th>
        <th>LOINC Code</th>
        <th>Description</th>
        <th>Composition</th>
        <th>Specimen</th>
        <th>Version</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let test of labTests">
        <td>{{ test.id }}</td>
        <td>{{ test.loinc_code || 'N/A' }}</td>
        <td>{{ test.description || 'N/A' }}</td>
        <td>{{ getCompositionDisplay(test.composition_id) }}</td>
        <td>{{ getSpecimenDisplay(test.specimen_id) }}</td>
        <td>{{ test.version }}</td>
        <td>
          <button class="btn btn-sm btn-primary me-2" (click)="openUpdateModal(test)">Update</button>
          <button class="btn btn-sm btn-danger" (click)="openDeleteModal(test)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Create LabTest Modal -->
<div class="modal fade" id="createLabTestModal" tabindex="-1" aria-labelledby="createLabTestModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createLabTestModalLabel">Create Lab Test</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onCreateSubmit()">
          <div class="mb-3">
            <label for="createTestCompositionId" class="form-label">Composition <span class="text-danger">*</span></label>
            <select class="form-control" id="createTestCompositionId" [(ngModel)]="createFormModel.composition_id" name="composition_id" required>
              <option [ngValue]="undefined" disabled selected>Select Composition</option>
              <option *ngFor="let comp of compositions" [value]="comp.id">{{ getCompositionDisplay(comp.id) }}</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="createTestSpecimenId" class="form-label">Specimen <span class="text-danger">*</span></label>
            <select class="form-control" id="createTestSpecimenId" [(ngModel)]="createFormModel.specimen_id" name="specimen_id" required>
              <option [ngValue]="undefined" disabled selected>Select Specimen</option>
              <option *ngFor="let spec of specimens" [value]="spec.id">{{ getSpecimenDisplay(spec.id) }}</option>
            </select>
          </div>          <div class="mb-3">
            <label for="createTestLoincCode" class="form-label">LOINC Code</label>
            <input type="text" class="form-control" id="createTestLoincCode" [(ngModel)]="createFormModel.loinc_code" name="loinc_code">
            <small class="text-muted">Optional</small>
          </div>
          <div class="mb-3">
            <label for="createTestDescription" class="form-label">Description</label>
            <textarea class="form-control" id="createTestDescription" [(ngModel)]="createFormModel.description" name="description" rows="3"></textarea>
            <small class="text-muted">Optional</small>
          </div>
          <button type="submit" class="btn btn-primary">Create</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Update LabTest Modal -->
<div class="modal fade" id="updateLabTestModal" tabindex="-1" aria-labelledby="updateLabTestModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateLabTestModalLabel">Update Lab Test</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onUpdateSubmit()">
          <input type="hidden" [(ngModel)]="updateFormModel.id" name="id_update">
          <div class="mb-3">
            <label for="updateTestCompositionId" class="form-label">Composition <span class="text-danger">*</span></label>
            <select class="form-control" id="updateTestCompositionId" [(ngModel)]="updateFormModel.composition_id" name="composition_id_update" required>
              <option *ngFor="let comp of compositions" [value]="comp.id">{{ getCompositionDisplay(comp.id) }}</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="updateTestSpecimenId" class="form-label">Specimen <span class="text-danger">*</span></label>
            <select class="form-control" id="updateTestSpecimenId" [(ngModel)]="updateFormModel.specimen_id" name="specimen_id_update" required>
              <option *ngFor="let spec of specimens" [value]="spec.id">{{ getSpecimenDisplay(spec.id) }}</option>
            </select>
          </div>          <div class="mb-3">
            <label for="updateTestLoincCode" class="form-label">LOINC Code</label>
            <input type="text" class="form-control" id="updateTestLoincCode" [(ngModel)]="updateFormModel.loinc_code" name="loinc_code_update">
            <small class="text-muted">Optional</small>
          </div>
          <div class="mb-3">
            <label for="updateTestDescription" class="form-label">Description</label>
            <textarea class="form-control" id="updateTestDescription" [(ngModel)]="updateFormModel.description" name="description_update" rows="3"></textarea>
            <small class="text-muted">Optional</small>
          </div>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteLabTestModal" tabindex="-1" aria-labelledby="deleteLabTestModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteLabTestModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" (click)="cancelDelete()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete Lab Test with ID {{ testToDelete?.id }}?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>
